{% if 'https' == unamapi_protocol %}
<VirtualHost *:443>
	SSLEngine on
	{% if unamapi_cert_file %}
	SSLCertificateFile {{ cert_file_path }}/{{ unamapi_cert_file }}
	{% else %}
	SSLCertificateFile /etc/pki/tls/certs/localhost.crt
	{% endif %}
	{% if unamapi_cert_key %}
	SSLCertificateKeyFile {{ cert_key_path }}/{{ unamapi_cert_key }}
	{% else %}
	SSLCertificateKeyFile /etc/pki/tls/private/localhost.key
	{% endif %}
	SSLProxyEngine on
 	SSLProxyVerify none
 	SSLProxyCheckPeerName off
  	SSLProxyCheckPeerCN off
  	SSLProxyCheckPeerExpire off

{% else %}
<VirtualHost *:80>
{% endif %}
	ServerName {{ unamapi_base_url }}
	ProxyRequests Off
    ProxyPreserveHost On
	<Proxy *>
{% if 'https' == unamapi_protocol %}
		RequestHeader set X-Forwarded-Proto "https"
{% endif %}
		Order deny,allow
		Allow from all
	</Proxy>

	ProxyPass {{ fhir_resources_uri }} http://localhost:{{ unamapi_external_port }}{{ unamapi_base_uri }}
    ProxyPassReverse {{ fhir_resources_uri }} http://localhost:{{ unamapi_external_port }}{{ unamapi_base_uri }}
</VirtualHost>
